const A=(e,c,i)=>{let o;const a=c,r={ok:!1,pos:c,value:""};for(o=e.charAt(c);c<i&&/\d/.test(o)||o==="%";)o=e.charAt(++c);return r.ok=!0,r.pos=c,r.value=e.slice(a,c),r},g=(e,c,i)=>{const o={ok:!1,pos:0,width:"",height:""};if(c>=i||e.charAt(c)!=="=")return o;c++;const a=e.charAt(c);if(a!=="x"&&!/\d/.test(a))return o;const r=A(e,c,i);if(c=r.pos,e.charAt(c)!=="x")return o;c++;const l=A(e,c,i);return c=l.pos,o.width=r.value,o.height=l.value,o.pos=c,o.ok=!0,o},k=(e,c)=>{const i=e.env,o=e.pos,a=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const r=e.pos+2,l=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(l<0)return!1;let t=l+1,n,p="",f="",m="",h="";if(t<a&&e.src.charAt(t)==="("){for(t++;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));)t++;if(t>=a)return!1;let s;s=e.md.helpers.parseLinkDestination(e.src,t,e.posMax),s.ok&&(p=e.md.normalizeLink(s.str),e.md.validateLink(p)?t=s.pos:p="");const u=t;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(s=e.md.helpers.parseLinkTitle(e.src,t,e.posMax),t<a&&u!==t&&s.ok)for(f=s.str,t=s.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);else f="";if(t-1>=0&&(n=e.src.charAt(t-1),n===" "&&(s=g(e.src,t,e.posMax),s.ok)))for(m=s.width,h=s.height,t=s.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!==`
`));t++);if(t>=a||e.src.charAt(t)!==")")return e.pos=o,!1;t++}else{let s="";if(typeof i.references>"u")return!1;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(t<a&&e.src.charAt(t)==="["){const d=t+1;t=e.md.helpers.parseLinkLabel(e,t),t>=0?s=e.src.slice(d,t++):t=l+1}else t=l+1;s||(s=e.src.slice(r,l));const u=i.references[e.md.utils.normalizeReference(s)];if(!u)return e.pos=o,!1;p=u.href,f=u.title??""}if(!c){e.pos=r,e.posMax=l;const s=e.src.slice(r,l),u=[];e.md.inline.parse(s,e.md,e.env,u);const d=e.push("image","img",0);d.attrs=[["src",p],["alt",""]],f&&d.attrs.push(["title",f]),m&&d.attrs.push(["width",m]),h&&d.attrs.push(["height",h]),d.children=u,d.content=s}return e.pos=t,e.posMax=a,!0},x=e=>{e.inline.ruler.before("emphasis","image",k)},L=(e,{strict:c=!1}={})=>{const i=e.renderer.rules.image;e.renderer.rules.image=(o,a,r,l,t)=>{const n=o[a],p=n.children?.[0]?.content;if(p){const f=/^(.*)\|(\d*)(?:x(\d*))?$/.exec(p);if(f){const[,m,h,s]=f;if(c&&(!h||!s)||h==="0"&&s==="0")return i(o,a,r,l,t);(!c||h&&s&&(h!=="0"||s!=="0"))&&(n.content=m,n.children[0].content=m,h&&h!=="0"&&n.attrSet("width",h),s&&s!=="0"&&n.attrSet("height",s))}}return i(o,a,r,l,t)}};export{L as imgSize,x as legacyImgSize};
//# sourceMappingURL=index.js.map
